<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>산업안전보건법 퀴즈 (모바일 개선/버튼)</title>
  <style>
    html, body { height: 100%; -webkit-text-size-adjust: 100%; }
    body { font-family: Arial, sans-serif; background:#f4f4f4; margin:0;
      display:flex; justify-content:center; align-items:center; min-height:100vh;
      overflow:auto; padding-bottom: env(safe-area-inset-bottom, 0); }
    .quiz-container{ width:100%; max-width:1100px; padding:16px; box-sizing:border-box; }
    .quiz-content{ display:flex; align-items:stretch; justify-content:center; gap:24px; width:100%; }
    .character-box{ flex:0 0 320px; max-width:35%; pointer-events:none; align-self:center; }
    .character-box img{ width:100%; height:auto; display:block; border-radius:8px; }
    .question-box{ flex:1 1 auto; min-width:0; background:#fff; padding:24px; border-radius:12px;
      box-shadow:0 0 10px rgba(0,0,0,0.08); text-align:center; display:flex; flex-direction:column;
      max-height:80vh; overflow-y:auto; scroll-padding-bottom:100px; }
    .progress-bar{width:100%;height:8px;background:rgba(0,0,0,0.1);border-radius:10px;margin-bottom:16px;overflow:hidden;}
    .progress-fill{height:100%;background:linear-gradient(90deg,#4CAF50,#45a049);border-radius:10px;transition:width .5s ease;}
    .question-counter{font-size:14px;color:#666;margin-bottom:12px;font-weight:600;}
    .question-box h2{font-size:18px;color:#333;margin:0 0 16px;line-height:1.5;word-break:keep-all;}
    input[type="text"]{ width:100%; padding:12px 14px; border:1px solid #ccc; border-radius:8px; font-size:16px; text-align:center; box-sizing:border-box; }
    #result-message{margin-top:14px;font-weight:bold;font-size:14px;line-height:1.4;word-break:keep-all;}
    .correct{color:#2e7d32;} .wrong{color:#d32f2f;} .warning{color:#ef6c00;}
    .button-box{ display:flex; justify-content:space-between; margin-top:16px; gap:10px;
      position:sticky; bottom:0; background:#fff; padding-top:8px; }
    .nav-btn{flex:1;padding:12px;border:none;border-radius:10px;font-size:16px;cursor:pointer;background:#4CAF50;color:#fff;transition:.2s;touch-action:manipulation;}
    .nav-btn:hover{background:#45a049;} .nav-btn:disabled{background:#ccc;cursor:not-allowed;}
    #navigation-info{position:absolute;bottom:2vh;left:2vw;color:#555;font-size:12px;max-width:40vw;}
    @media (max-width:768px){
      body{min-height:100dvh;}
      .quiz-content{flex-direction:column;gap:12px;align-items:stretch;}
      .character-box{flex:0 0 auto;width:56vw;max-width:200px;margin:4px auto 0;}
      .character-box img{max-height:25vh;object-fit:contain;}
      .question-box{width:100%;max-height:unset;overflow:visible;padding:18px;}
      .question-box h2{font-size:16px;}
      input[type="text"]{font-size:17px;line-height:1.5;padding:14px 12px;}
      .question-counter{font-size:13px;margin-bottom:10px;}
      #navigation-info{display:none!important;}
    }
    @media (max-width:380px){ .character-box{display:none;} }
    #fatal-error{color:#d32f2f; font-size:14px; text-align:left; white-space:pre-wrap; margin-top:8px;}
  </style>
</head>
<body>
  <div class="quiz-container">
    <div class="quiz-content">
      <div class="character-box">
        <img id="announcer-character" src="announcer_default.gif" alt="아나운서 캐릭터"
             onerror="this.parentElement.style.display='none'">
      </div>
      <div class="question-box">
        <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
        <div class="question-counter" id="question-counter"></div>
        <div id="quiz-question"></div>
        <div id="result-message"></div>
        <div id="fatal-error"></div>
        <div class="button-box">
          <button id="prev-btn" class="nav-btn">⬅ 이전</button>
          <button id="next-btn" class="nav-btn">다음 ➡</button>
        </div>
      </div>
    </div>
  </div>

  <div id="navigation-info">
    <span>💡 엔터(Enter)는 다음 문제, Alt+b는 이전 문제</span><br />
    <span>Alt+z 키를 누르면 처음으로 돌아갑니다.</span>
  </div>

  <script>
    // 전역 오류를 화면에 표시
    window.addEventListener('error', (e) => {
      const el = document.getElementById('fatal-error');
      if (el) el.textContent = '자바스크립트 오류: ' + e.message;
    });

    document.addEventListener('DOMContentLoaded', () => {
      const showFatal = (msg) => {
        const el = document.getElementById('fatal-error');
        if (el) el.textContent = msg;
      };

      try {
        // === 여기가 파싱 에러의 주범이었습니다. 모든 객체 끝에 쉼표가 있습니다. ===
        const quizData = [
          { question:"산업안전보건법상 안전보건관리규정을 작성할 때 포함되어야 할 사항 1번", answer:["안전 및 보건에 관한 관리조직과 그 직무에 관한 사항"] },
          { question:"산업안전보건법상 안전보건관리규정을 작성할 때 포함되어야 할 사항 2번", answer:["안전보건교육에 관한 사항"] },
          { question:"산업안전보건법상 안전보건관리규정을 작성할 때 포함되어야 할 사항 3번", answer:["작업장의 안전 및 보건관리에 관한 사항"] },
          { question:"산업안전보건법상 안전보건관리규정을 작성할 때 포함되어야 할 사항 4번", answer:["사고조사 및 대책수립에 관한 사항"] },
          { question:"다음에있는 안전밸브 형식 표시사항에 대해 순서대로 설명하여 쓰시오 : SF II 1-B (단 마지막에 있는 B는 제외) 1. S", answer:["요구성능(증기의 분출압력을 요구)"] },
          { question:"다음에있는 안전밸브 형식 표시사항에 대해 순서대로 설명하여 쓰시오 : SF II 1-B (단 마지막에 있는 B는 제외) 2. F", answer:["유량제한기구(전량식)"] },
          { question:"다음에있는 안전밸브 형식 표시사항에 대해 순서대로 설명하여 쓰시오 : SF II 1-B (단 마지막에 있는 B는 제외) 3. II", answer:["호칭입구 크기 구분(25mm 초과 50 mm 이하)"] },
          { question:"다음에있는 안전밸브 형식 표시사항에 대해 순서대로 설명하여 쓰시오 : SF II 1-B (단 마지막에 있는 B는 제외) 4. 1", answer:["호칭압력구분(1MPa 이하)"] },
          { question:"유해, 위험 방지를 위한 방호조치를 하지 아니하고는 양도, 대여, 설치 또는 사용에 제공하거나 양도, 대여의 목적으로 진열해서는 아니되는 기계, 기구를 6가지 쓰시오", answer:["예초기","원심기","공기압축기","금속절단기","지게차","포장기계(진공포장기, 래핑기로 한정)"] },
          { question:"보호구 안전인증고시상 안전인증 대상 안전모의 시험 성능 항목을 6가지 쓰시오", answer:["내관통성시험","내전압성시험","난연성시험","충격흡수시험","내수성시험","턱끈풀림시험"] },
          { question:"클러치맞물림개소수가 4개, 300SPM인 프레스기 양수기동식 방호장치의 안전거리(mm)를 계산하시오", answer:["240mm"] },
          { question:"연평균근로자 1440명이 근무… 사망재해가 1명 발생했을 때 강도율을 계산하시오", answer:["약 3.1"] },
          { question:"( ) 안에 적합한 내용을 쓰시오… 계획서를 제출해야 한다.", answer:["안전보건개선계획","60"] },
          { question:"손쳐내기식 방호장치 (1)기계명 (2)분류기호", answer:["프레스","D"] },
          { question:"안전보건표지의 명칭을 각각 쓰시오", answer:["폭발성물질 경고","부식성물질 경고","물체이동 금지","들것"] },
          { question:"철골작업 중지 기상조건 (풍속/강우량/강설량)", answer:["10m","1mm","1cm"] },
          { question:"형식별 제품심사 60일 보호구 8가지", answer:["추락 및 감전위험방지용 안전모","안전화","안전장갑","방진마스크","방독마스크","송기마스크","전동식 호흡보호구","보호복"] },
          { question:"누전차단기: 정격감도전류(mA), 작동시간(초)", answer:["30","0.03"] },
          { question:"작업중지 해제 절차 (근로자/근로감독관/4일/위원회)", answer:["근로자","근로감독관","4일","작업중지해제심의위원회"] },
          { question:"간단 공정의 위험성평가기법 2가지(보기에서)", answer:["상대위험순위 결정기법","작업자 실수분석기법"] },
          { question:"설치·이전 시 안전인증 기계 3가지", answer:["크레인","리프트","곤돌라"] },
          { question:"안전보건관리규정 4가지", answer:["안전 및 보건에 관한 관리조직과 그 직무에 관한 사항","안전보건교육에 관한 사항","작업장의 안전 및 보건관리에 관한 사항","사고조사 및 대책 수립에 관한 사항"] },
          { question:"자동차 제조업 상시근로자 수 (규정 작성 의무 기준)", answer:["100명"] },
          { question:"로봇 작업지침 포함 5가지", answer:["로봇의 조작 방법 및 순서","작업중의 매니퓰레이터의 속도","2명이상의 근로자에게 작업을 시킬 경우의 신호 방법","이상을 발견한 경우의 조치","이상을 발견하여 로봇의 운전을 정지시킨 후 이를 재가동시킬 경우의 조치"] },
          { question:"허가대상물질 작업장 표지 하단 2가지", answer:["보호구 및 보호복 착용","흡연 및 음식물 섭취 금지"] },
          { question:"중대산업사고 정의", answer:["유해하거나 위험한 설비로부터의 위험물질 누출, 화재 및 폭발 등으로 인하여 사업장 내의 근로자에게 즉시 피해를 주거나 사업장 인근지역에 피해를 줄 수 있는 사고"] },
          { question:"중대산업사고 예방 보고서 명칭", answer:["공정안전보고서"] },
          { question:"MSDS 교육해야 하는 경우 3가지", answer:["새로운 물질안전보건자료 대상물질이 도입된 경우","유해성 및 위험성 정보가 변경된 경우","물질안전보건자료 대상물질을 제조, 사용, 운반 또는 저장하는 작업에 근로자를 배치하게 된 경우"] },
          { question:"안전검사 주기 (리프트/산업용 로봇)", answer:["6","3","2"] },
          { question:"양중기 명칭 (호이스트/크레인)", answer:["호이스트","크레인"] },
          { question:"유해위험방지계획서 첨부서류 4가지", answer:["건축물 각 층의 평면도","기계 및 설비의 개요를 나타내는 서류","기계 및 설비의 배치도면","원재료 및 제품의 취급, 제조 등의 작업방법의 개요"] },
          { question:"와이어로프 안전율 (42.8kN, 1500kg, 60도) 결과", answer:["5.04","안전율이 5 이상이므로 만족"] },
          { question:"리프트/곤돌라 특별교육 5가지", answer:["방호장치의 기능 및 사용에 관한 사항","기계, 기구, 달기체인 및 와이어 등의 점검에 관한 사항","화물의 권상, 권하작업방법 및 안전작업지도에 관한 사항","기계, 기구의 특성 및 동작원리에 관한 사항","신호방법 및 공동작업에 관한 사항"] },
          { question:"BLEVE 영향 인자 5가지", answer:["저장용기의 재질","주위온도와 압력상태","저장된 물질의 종류와 형태","내용물의 물질적 역학상태","내용물의 인화성 및 독성 여부"] },
          { question:"금지 섬유로프 2가지", answer:["꼬임이 끊어진 것","심하게 손상되거나 부식된 것"] },
          { question:"중량물 취급 작업 전 점검 4가지", answer:["중량물 취급의 올바른 자세 및 복장","위험물이 날아 흩어짐에 따른 보호구의 착용","카바이드, 생석회(산화칼슘) 등과 같이 온도상승이나 습기에 의하여 위험성이 존재하는 중량물의 취급방법","그밖에 하역운반기계 등의 적절한 사용방법"] },
          { question:"정전기 위험 시 인체 조치 4가지", answer:["정전기 대전방지용 안전화 착용","제전복 착용","정전기 제전용구 사용","작업장 바닥 등에 도전성을 갖추도록 함"] },
          { question:"이사회 보고·승인 대상 회사 기준 (500명/1000위)", answer:["500","1000"] },
          { question:"사망만인율 계산 (5명, 20,000명…)", answer:["2.5"] },
          { question:"안전블록 명칭 및 구조 기준 2가지", answer:["안전블록","자동잠김장치를 갖출것, 안전블록의 부품은 부식방지처리를 할 것"] },
          { question:"공정안전보고서 제출 의무 조항", answer:["공정안전보고서"] },
          { question:"공정안전보고서 작성 시 위원회 심의", answer:["공정안전보고서","산업안전보건위원회","산업안전보건위원회"] },
          { question:"재해발생 형태 (넘어짐/폭발/끼임/떨어짐)", answer:["넘어짐"] },
          { question:"재해발생 형태 (복합: 폭발과 화재)", answer:["폭발"] },
          { question:"전도로 협착 절단", answer:["끼임"] },
          { question:"바닥과 분리된 상태로 추락", answer:["떨어짐"] },
          { question:"위험물질 분류 (등유/과염소산/아세틸렌)", answer:["등유","과염소산","아세틸렌"] },
          { question:"양중기 종류 5가지", answer:["승강기","곤돌라","리프트(…0.1톤 이상)","이동식 크레인","크레인(호이스트 포함)"] },
          { question:"1급 방진마스크 사용장소 3가지", answer:["특급 제외 분진 발생장소","금속 흄 등 열적으로 생기는 분진장소","기계적으로 생기는 분진장소(2급으로 무방한 경우 제외)"] },
          { question:"작업발판일체형 거푸집 4가지", answer:["갱폼","슬립폼","클라이밍폼","터널라이닝폼"] },
          { question:"접지해야 하는 비충전금속체 (보기 2,4)", answer:["2","4"] },
          { question:"절연장갑 등급 00/0/1/2/3/4 전압·색상", answer:["750","1,000","11,250","17,000","녹색","36,000","54,000"] },
          { question:"가설통로 설치 기준 6가지", answer:["견고한 구조","경사 30도 이하","경사 15도 초과 시 미끄럼 방지","추락 위험 장소 안전난간","수직 갱 15m 이상은 10m 이내 계단참","비계다리 8m 이상은 7m 이내 계단참"] },
          { question:"차광보안경 종류 4가지", answer:["자외선용","적외선용","복합용","용접용"] },
          { question:"압력용기 파열판 반드시 설치 3가지", answer:["반응폭주 등 급격한 압력상승 우려","급성독성물질 누출로 작업환경 오염 우려","운전 중 안전밸브에 이상물질 누적 우려"] },
          { question:"작업장 조도 기준 (750/300/150/75 lux)", answer:["750","300","150","75"] },
          { question:"타워크레인 설치·해체 특별교육 4가지 이상", answer:["붕괴·추락·재해방지","설치·해체순서 및 안전작업방법","부재의 구조·재질·특성","신호방법 및 요령","이상발생시 응급조치"] },
          { question:"종합재해지수 계산 문제", answer:["8.91"] },
          { question:"충전선로 접근한계거리 (350V/1.8kV/7.6kV/22.9kV)", answer:["30cm","45cm","60cm","90cm"] },
          { question:"위험성평가 실시 순서", answer:["3 2 4 1 5 6"] },
          { question:"비·눈 후 비계 작업 전 점검 6가지", answer:["발판재료 손상/부착 상태","연결재료·철물 손상/부식","연결부·접속부 풀림","손잡이 탈락","로프 부착·매단 흔들림","기둥 침하·변형·변위·흔들림"] },
          { question:"소음작업 기준 (85dB/90dB 8시간/100dB 2시간)", answer:["85","8","2"] },
          { question:"PSM 대상 규정량 (인화성가스/암모니아/염산/황산)", answer:["200,000kg","10,000kg","20,000kg","20,000kg"] },
          { question:"작업조건별 보호구 (안전모/보안경/안전대/방열복)", answer:["안전모","보안경","안전대","방열복"] },
          { question:"유해위험방지계획서 대상 설비 5가지", answer:["금속·광물 용해로","화학설비","건조설비","가스집합용접장치","유해물질 밀폐·환기·배기 설비"] },
        ];

        // ====== 첫 화면 그리기 ======
        let currentQuestionIndex = 0;
        let isAnswerChecked = false;
        let correctAnswersCount = 0;
        let totalAnswered = 0;

        const quizQuestionElement = document.getElementById('quiz-question');
        const resultMessageElement = document.getElementById('result-message');
        const announcerCharacter = document.getElementById('announcer-character');
        const progressFill = document.getElementById('progress-fill');
        const questionCounter = document.getElementById('question-counter');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');

        function updateProgress() {
          const progress = (currentQuestionIndex / quizData.length) * 100;
          progressFill.style.width = progress + '%';
          questionCounter.textContent = `문제 ${currentQuestionIndex + 1} / ${quizData.length}`;
          prevBtn.disabled = currentQuestionIndex === 0;
        }

        function createQuestion(index) {
          if (index >= 0 && index < quizData.length) {
            const q = quizData[index];
            const placeholderText = q.answer.length > 1
              ? "쉼표(,)로 구분하여 모두 입력하세요"
              : "정답을 입력하세요";
            quizQuestionElement.innerHTML = `
              <h2>Q${index + 1}. ${q.question}</h2>
              <input type="text" id="user-answer" placeholder="${placeholderText}" autocomplete="off" inputmode="text">
            `;
            updateProgress();
            const ua = document.getElementById('user-answer');
            if (ua) {
              ua.focus();
              ua.addEventListener('focus', () => {
                setTimeout(() => { ua.scrollIntoView({ block: 'center', behavior: 'smooth' }); }, 100);
              });
            }
            resultMessageElement.textContent = "";
            resultMessageElement.className = "";
            changeCharacterEmotion('default');
            isAnswerChecked = false;
          } else if (index >= quizData.length) {
            const accuracy = totalAnswered ? Math.round((correctAnswersCount / totalAnswered) * 100) : 0;
            quizQuestionElement.innerHTML = `
              <h2>🎉 퀴즈가 끝났습니다! 🎉</h2>
              <p>총 ${totalAnswered}문제 중 ${correctAnswersCount}문제 정답</p>
              <p>정답률: ${accuracy}%</p>
            `;
            progressFill.style.width = '100%';
            questionCounter.textContent = "완료!";
            resultMessageElement.textContent = "";
            resultMessageElement.className = "";
            changeCharacterEmotion('finish');
          } else {
            currentQuestionIndex = 0;
            createQuestion(currentQuestionIndex);
          }
        }

        function changeCharacterEmotion(emotion) {
          const imgMap = {
            correct: "announcer_correct.gif",
            wrong: "announcer_wrong.gif",
            finish: "announcer_finish.gif",
            default: "announcer_default.gif"
          };
          const src = imgMap[emotion] || imgMap.default;
          if (announcerCharacter) announcerCharacter.src = src;
        }

        function normalize(s) {
          return (s || "")
            .toLowerCase()
            .replace(/\s+/g, '')
            .replace(/[()［］\[\]{}]/g, '')
            .replace(/[.,:;\/\\\-–—_~'"“”‘’`]/g, '');
        }

        function checkAnswer() {
          const uaEl = document.getElementById('user-answer');
          const userRaw = (uaEl?.value || "").trim();
          const userAnswer = normalize(userRaw);

          const correctRaw = quizData[currentQuestionIndex].answer;
          const correctAnswers = correctRaw.map(a => normalize(a));

          let isCorrect = false;
          if (correctAnswers.length > 1) {
            const userArr = userRaw.split(',').map(s => normalize(s)).filter(Boolean);
            if (userArr.length === correctAnswers.length) {
              isCorrect = correctAnswers.every(ca => userArr.includes(ca));
            } else {
              isCorrect = false;
            }
          } else {
            isCorrect = correctAnswers.includes(userAnswer);
          }

          totalAnswered++;
          if (isCorrect) {
            correctAnswersCount++;
            resultMessageElement.textContent = "✅ 정답입니다!";
            resultMessageElement.className = "correct";
            changeCharacterEmotion('correct');
            return true;
          } else {
            resultMessageElement.textContent = `❌ 틀렸습니다. 정답은 '${quizData[currentQuestionIndex].answer.join(', ')}' 입니다.`;
            resultMessageElement.className = "wrong";
            changeCharacterEmotion('wrong');
            return false;
          }
        }

        function resetQuiz() {
          currentQuestionIndex = 0;
          correctAnswersCount = 0;
          totalAnswered = 0;
          createQuestion(currentQuestionIndex);
          alert("퀴즈가 처음으로 돌아갑니다.");
        }

        prevBtn.addEventListener('click', () => {
          if (currentQuestionIndex > 0) {
            currentQuestionIndex--;
            createQuestion(currentQuestionIndex);
          }
        });

        nextBtn.addEventListener('click', () => {
          const userInput = document.getElementById('user-answer');
          if (userInput && !isAnswerChecked) {
            if (userInput.value.trim() === "") {
              resultMessageElement.textContent = "답을 입력해주세요.";
              resultMessageElement.className = "warning";
              return;
            }
            const correct = checkAnswer();
            isAnswerChecked = true;
            if (correct) setTimeout(() => { currentQuestionIndex++; createQuestion(currentQuestionIndex); }, 700);
          } else {
            currentQuestionIndex++;
            createQuestion(currentQuestionIndex);
          }
        });

        document.addEventListener('keydown', (event) => {
          if (event.altKey && event.key === 'z') { resetQuiz(); return; }
          if (event.altKey && event.key === 'b') {
            if (currentQuestionIndex > 0) { currentQuestionIndex--; createQuestion(currentQuestionIndex); }
            return;
          }
          if (event.key === 'Enter') {
            const userInput = document.getElementById('user-answer');
            if (!userInput) return;
            if (userInput.value.trim() === "") {
              resultMessageElement.textContent = "답을 입력해주세요.";
              resultMessageElement.className = "warning";
              return;
            }
            if (!isAnswerChecked) {
              const correct = checkAnswer();
              isAnswerChecked = true;
              if (correct) setTimeout(() => { currentQuestionIndex++; createQuestion(currentQuestionIndex); }, 700);
            } else {
              currentQuestionIndex++;
              createQuestion(currentQuestionIndex);
            }
          }
        });

        // 첫 화면 그리기
        if (!Array.isArray(quizData) || quizData.length === 0) {
          showFatal('데이터가 비어 있습니다.');
        } else {
          createQuestion(currentQuestionIndex);
        }
      } catch (err) {
        showFatal('초기화 중 오류: ' + (err && err.message ? err.message : String(err)));
      }
    });
  </script>
</body>
</html>
