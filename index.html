<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì‚°ì—…ì•ˆì „ë³´ê±´ë²• í€´ì¦ˆ (ëª¨ë°”ì¼ ê°œì„ /ë²„íŠ¼)</title>
  <style>
    html, body { height: 100%; -webkit-text-size-adjust: 100%; }
    body { font-family: Arial, sans-serif; background:#f4f4f4; margin:0;
      display:flex; justify-content:center; align-items:center; min-height:100vh;
      overflow:auto; padding-bottom: env(safe-area-inset-bottom, 0); }
    .quiz-container{ width:100%; max-width:1100px; padding:16px; box-sizing:border-box; }
    .quiz-content{ display:flex; align-items:stretch; justify-content:center; gap:24px; width:100%; }
    .character-box{ flex:0 0 320px; max-width:35%; pointer-events:none; align-self:center; }
    .character-box img{ width:100%; height:auto; display:block; border-radius:8px; }
    .question-box{ flex:1 1 auto; min-width:0; background:#fff; padding:24px; border-radius:12px;
      box-shadow:0 0 10px rgba(0,0,0,0.08); text-align:center; display:flex; flex-direction:column;
      max-height:80vh; overflow-y:auto; scroll-padding-bottom:100px; }
    .progress-bar{width:100%;height:8px;background:rgba(0,0,0,0.1);border-radius:10px;margin-bottom:16px;overflow:hidden;}
    .progress-fill{height:100%;background:linear-gradient(90deg,#4CAF50,#45a049);border-radius:10px;transition:width .5s ease;}
    .question-counter{font-size:14px;color:#666;margin-bottom:12px;font-weight:600;}
    .question-box h2{font-size:18px;color:#333;margin:0 0 16px;line-height:1.5;word-break:keep-all;}
    input[type="text"]{ width:100%; padding:12px 14px; border:1px solid #ccc; border-radius:8px; font-size:16px; text-align:center; box-sizing:border-box; }
    #result-message{margin-top:14px;font-weight:bold;font-size:14px;line-height:1.4;word-break:keep-all;}
    .correct{color:#2e7d32;} .wrong{color:#d32f2f;} .warning{color:#ef6c00;}
    .button-box{ display:flex; justify-content:space-between; margin-top:16px; gap:10px;
      position:sticky; bottom:0; background:#fff; padding-top:8px; }
    .nav-btn{flex:1;padding:12px;border:none;border-radius:10px;font-size:16px;cursor:pointer;background:#4CAF50;color:#fff;transition:.2s;touch-action:manipulation;}
    .nav-btn:hover{background:#45a049;} .nav-btn:disabled{background:#ccc;cursor:not-allowed;}
    #navigation-info{position:absolute;bottom:2vh;left:2vw;color:#555;font-size:12px;max-width:40vw;}
    @media (max-width:768px){
      body{min-height:100dvh;}
      .quiz-content{flex-direction:column;gap:12px;align-items:stretch;}
      .character-box{flex:0 0 auto;width:56vw;max-width:200px;margin:4px auto 0;}
      .character-box img{max-height:25vh;object-fit:contain;}
      .question-box{width:100%;max-height:unset;overflow:visible;padding:18px;}
      .question-box h2{font-size:16px;}
      input[type="text"]{font-size:17px;line-height:1.5;padding:14px 12px;}
      .question-counter{font-size:13px;margin-bottom:10px;}
      #navigation-info{display:none!important;}
    }
    @media (max-width:380px){ .character-box{display:none;} }
    #fatal-error{color:#d32f2f; font-size:14px; text-align:left; white-space:pre-wrap; margin-top:8px;}
  </style>
</head>
<body>
  <div class="quiz-container">
    <div class="quiz-content">
      <div class="character-box">
        <img id="announcer-character" src="announcer_default.gif" alt="ì•„ë‚˜ìš´ì„œ ìºë¦­í„°"
             onerror="this.parentElement.style.display='none'">
      </div>
      <div class="question-box">
        <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
        <div class="question-counter" id="question-counter"></div>
        <div id="quiz-question"></div>
        <div id="result-message"></div>
        <div id="fatal-error"></div>
        <div class="button-box">
          <button id="prev-btn" class="nav-btn">â¬… ì´ì „</button>
          <button id="next-btn" class="nav-btn">ë‹¤ìŒ â¡</button>
        </div>
      </div>
    </div>
  </div>

  <div id="navigation-info">
    <span>ğŸ’¡ ì—”í„°(Enter)ëŠ” ë‹¤ìŒ ë¬¸ì œ, Alt+bëŠ” ì´ì „ ë¬¸ì œ</span><br />
    <span>Alt+z í‚¤ë¥¼ ëˆ„ë¥´ë©´ ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.</span>
  </div>

  <script src="quiz_data.js"></script>
  
  <script>
    // ì „ì—­ ì˜¤ë¥˜ë¥¼ í™”ë©´ì— í‘œì‹œ
    window.addEventListener('error', (e) => {
      const el = document.getElementById('fatal-error');
      if (el) el.textContent = 'ìë°”ìŠ¤í¬ë¦½íŠ¸ ì˜¤ë¥˜: ' + e.message;
    });

    document.addEventListener('DOMContentLoaded', () => {
      const showFatal = (msg) => {
        const el = document.getElementById('fatal-error');
        if (el) el.textContent = msg;
      };

      try {
        // ====== ì²« í™”ë©´ ê·¸ë¦¬ê¸° ======
        let currentQuestionIndex = 0;
        let isAnswerChecked = false;
        let correctAnswersCount = 0;
        let totalAnswered = 0;

        const quizQuestionElement = document.getElementById('quiz-question');
        const resultMessageElement = document.getElementById('result-message');
        const announcerCharacter = document.getElementById('announcer-character');
        const progressFill = document.getElementById('progress-fill');
        const questionCounter = document.getElementById('question-counter');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');

        function updateProgress() {
          const progress = (currentQuestionIndex / quizData.length) * 100;
          progressFill.style.width = progress + '%';
          questionCounter.textContent = `ë¬¸ì œ ${currentQuestionIndex + 1} / ${quizData.length}`;
          prevBtn.disabled = currentQuestionIndex === 0;
        }

        function createQuestion(index) {
          if (index >= 0 && index < quizData.length) {
            const q = quizData[index];
            const placeholderText = q.answer.length > 1
              ? "ì‰¼í‘œ(,)ë¡œ êµ¬ë¶„í•˜ì—¬ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”"
              : "ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”";
            quizQuestionElement.innerHTML = `
              <h2>Q${index + 1}. ${q.question}</h2>
              <input type="text" id="user-answer" placeholder="${placeholderText}" autocomplete="off" inputmode="text">
            `;
            updateProgress();
            const ua = document.getElementById('user-answer');
            if (ua) {
              ua.focus();
              ua.addEventListener('focus', () => {
                setTimeout(() => { ua.scrollIntoView({ block: 'center', behavior: 'smooth' }); }, 100);
              });
            }
            resultMessageElement.textContent = "";
            resultMessageElement.className = "";
            changeCharacterEmotion('default');
            isAnswerChecked = false;
          } else if (index >= quizData.length) {
            const accuracy = totalAnswered ? Math.round((correctAnswersCount / totalAnswered) * 100) : 0;
            quizQuestionElement.innerHTML = `
              <h2>ğŸ‰ í€´ì¦ˆê°€ ëë‚¬ìŠµë‹ˆë‹¤! ğŸ‰</h2>
              <p>ì´ ${totalAnswered}ë¬¸ì œ ì¤‘ ${correctAnswersCount}ë¬¸ì œ ì •ë‹µ</p>
              <p>ì •ë‹µë¥ : ${accuracy}%</p>
            `;
            progressFill.style.width = '100%';
            questionCounter.textContent = "ì™„ë£Œ!";
            resultMessageElement.textContent = "";
            resultMessageElement.className = "";
            changeCharacterEmotion('finish');
          } else {
            currentQuestionIndex = 0;
            createQuestion(currentQuestionIndex);
          }
        }

        function changeCharacterEmotion(emotion) {
          const imgMap = {
            correct: "announcer_correct.gif",
            wrong: "announcer_wrong.gif",
            finish: "announcer_finish.gif",
            default: "announcer_default.gif"
          };
          const src = imgMap[emotion] || imgMap.default;
          if (announcerCharacter) announcerCharacter.src = src;
        }

        function normalize(s) {
          return (s || "")
            .toLowerCase()
            .replace(/\s+/g, '')
            .replace(/[()ï¼»ï¼½\[\]{}]/g, '')
            .replace(/[.,:;\/\\\-â€“â€”_~'"â€œâ€â€˜â€™`]/g, '');
        }

        function checkAnswer() {
          const uaEl = document.getElementById('user-answer');
          const userRaw = (uaEl?.value || "").trim();
          const userAnswer = normalize(userRaw);

          const correctRaw = quizData[currentQuestionIndex].answer;
          const correctAnswers = correctRaw.map(a => normalize(a));

          let isCorrect = false;
          if (correctAnswers.length > 1) {
            const userArr = userRaw.split(',').map(s => normalize(s)).filter(Boolean);
            if (userArr.length === correctAnswers.length) {
              isCorrect = correctAnswers.every(ca => userArr.includes(ca));
            } else {
              isCorrect = false;
            }
          } else {
            isCorrect = correctAnswers.includes(userAnswer);
          }

          totalAnswered++;
          if (isCorrect) {
            correctAnswersCount++;
            resultMessageElement.textContent = "âœ… ì •ë‹µì…ë‹ˆë‹¤!";
            resultMessageElement.className = "correct";
            changeCharacterEmotion('correct');
            return true;
          } else {
            resultMessageElement.textContent = `âŒ í‹€ë ¸ìŠµë‹ˆë‹¤. ì •ë‹µì€ '${quizData[currentQuestionIndex].answer.join(', ')}' ì…ë‹ˆë‹¤.`;
            resultMessageElement.className = "wrong";
            changeCharacterEmotion('wrong');
            return false;
          }
        }

        function resetQuiz() {
          currentQuestionIndex = 0;
          correctAnswersCount = 0;
          totalAnswered = 0;
          createQuestion(currentQuestionIndex);
          alert("í€´ì¦ˆê°€ ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.");
        }

        // âœ… ìˆ˜ì • 1: 'ë‹¤ìŒ' ë²„íŠ¼ í´ë¦­ ì‹œ ìë™ ì´ë™ ì œê±° (ì •ë‹µì´ì–´ë„ ë©ˆì¶¤)
        prevBtn.addEventListener('click', () => {
          if (currentQuestionIndex > 0) {
            currentQuestionIndex--;
            createQuestion(currentQuestionIndex);
          }
        });

        nextBtn.addEventListener('click', () => {
          const userInput = document.getElementById('user-answer');
          if (userInput && !isAnswerChecked) {
            if (userInput.value.trim() === "") {
              resultMessageElement.textContent = "ë‹µì„ ì…ë ¥í•´ì£¼ì„¸ìš”.";
              resultMessageElement.className = "warning";
              return;
            }
            const correct = checkAnswer();
            isAnswerChecked = true;
            // (ìë™ ì§„í–‰ ì—†ìŒ) -> ë‹¤ì‹œ 'ë‹¤ìŒ'ì„ ëˆŒëŸ¬ì•¼ ë‹¤ìŒ ë¬¸ì œë¡œ ì´ë™
          } else {
            currentQuestionIndex++;
            createQuestion(currentQuestionIndex);
          }
        });

        // âœ… ìˆ˜ì • 2: Enter í‚¤ì—ì„œë„ ë™ì¼í•œ íë¦„ (ì²« Enter=ì±„ì ë§Œ, ë‘ ë²ˆì§¸ Enter=ë‹¤ìŒìœ¼ë¡œ)
        document.addEventListener('keydown', (event) => {
          if (event.altKey && event.key === 'z') { resetQuiz(); return; }
          if (event.altKey && event.key === 'b') {
            if (currentQuestionIndex > 0) { currentQuestionIndex--; createQuestion(currentQuestionIndex); }
            return;
          }
          if (event.key === 'Enter') {
            const userInput = document.getElementById('user-answer');
            if (!userInput) return;
            if (userInput.value.trim() === "") {
              resultMessageElement.textContent = "ë‹µì„ ì…ë ¥í•´ì£¼ì„¸ìš”.";
              resultMessageElement.className = "warning";
              return;
            }
            if (!isAnswerChecked) {
              const correct = checkAnswer();
              isAnswerChecked = true;
              // (ìë™ ì§„í–‰ ì—†ìŒ) -> ë‹¤ì‹œ Enterë¥¼ ëˆŒëŸ¬ì•¼ ë‹¤ìŒ ë¬¸ì œë¡œ ì´ë™
            } else {
              currentQuestionIndex++;
              createQuestion(currentQuestionIndex);
            }
          }
        });

        // ì²« í™”ë©´ ê·¸ë¦¬ê¸°
        if (!Array.isArray(quizData) || quizData.length === 0) {
          showFatal('ë°ì´í„°ê°€ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.');
        } else {
          createQuestion(currentQuestionIndex);
        }
      } catch (err) {
        showFatal('ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜: ' + (err && err.message ? err.message : String(err)));
      }
    });
  </script>
</body>
</html>
